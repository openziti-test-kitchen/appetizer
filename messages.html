<!DOCTYPE html>
<html>
<body>

<h1>Getting server updates</h1>
<div id="result"></div>

<script>
    const arraySize = 20;
    const myArray = new Array(arraySize);
    let idx = 0;
    function addMessage(msg) {
        console.log("addMessage: " + msg)
        if(idx >= arraySize) {
            idx = 0;
        }
        myArray[idx] = msg;
        idx ++;
    }

    function renderMessages() {
        document.getElementById("result").innerHTML = "";
        for (let i = idx; i < arraySize; i++) {
            renderMessage(myArray[i]);
        }

        for (let i = 0; i < idx; i++) {
            renderMessage(myArray[i]);
        }
    }

    function renderMessage(msg) {
        if(msg) {
            document.getElementById("result").innerHTML += msg + "<br>";
        }
    }

    function notifyHandler(event) {
        console.log("notifyHandler")
        addMessage(event.data);
        renderMessages();
    }

    if(typeof(EventSource) !== "undefined") {
        let source = new EventSource("sse");
        source.addEventListener('notify', notifyHandler, false);
    } else {
        document.getElementById("result").innerHTML = "Sorry, your browser does not support server-sent events...";
    }
</script>

</body>
</html>